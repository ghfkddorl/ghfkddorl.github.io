<!doctype html>
<html>
	<head>
		<title>제약이 있는 경사하강법 //  [ 프로그래밍 일기장 ] </title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="description" content="" />
		
		
		<link rel="stylesheet" href="https://ghfkddorl.github.io/css/main.css"/>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?delayStartupUntil=configured"></script>
		<script type="text/javascript" src="https://ghfkddorl.github.io/js/main.js"></script>
	</head>

	<body onload="onload()">
		<div id="app-sidebtn"
			onclick="openSidebar()">
			~$ tree content
		</div>
		<aside id="app-sidebar">
			
<header>
	<div class="icon-wrap" onclick="closeSidebar()">
	<div class="icon svg-ajax" id="icon-close">/img/close.svg</div>
	</div>
	~ $ tree content
</header>

<div class="menu-wrap">
<ul class="menu">
	<li class="item"> Django</li>
	<ul class="sub-menu"></ul>

	<li class="item"> Hugo And Blog</li>
	<ul class="sub-menu">
		<li class="sub-item"> <a href=https://ghfkddorl.github.io/section_hugo/003_html_md_%EB%A6%AC%EC%86%8C%EC%8A%A4%EB%A1%9C/> HTML MD 파일은 리소스로 사용하기</a></li>
	
		<li class="sub-item"> <a href=https://ghfkddorl.github.io/section_hugo/001_%EB%A7%88%ED%81%AC%EB%8B%A4%EC%9A%B4%EC%BD%94%EB%93%9C%EB%84%A3%EA%B8%B0/post1/> 마크마운 : 코드 넣기</a></li>
	
		<li class="sub-item"> <a href=https://ghfkddorl.github.io/section_hugo/002_%EB%A7%88%ED%81%AC%EB%8B%A4%EC%9A%B4%EC%88%98%EC%8B%9D%EB%84%A3%EA%B8%B0/> 마크다운 : 수식 넣기</a></li>
	</ul>

	<li class="item"> ML</li>
	<ul class="sub-menu">
		<li class="sub-item"> <a href=https://ghfkddorl.github.io/section_machine_learning/001_gd/> 제약이 있는 경사하강법</a></li>
	</ul>

	<li class="item"> Python</li>
	<ul class="sub-menu">
		<li class="sub-item"> <a href=https://ghfkddorl.github.io/section_python/002_%EC%9D%B4%ED%84%B0%EB%9F%AC%EB%B8%942/> 이터러블-제너레이터(2)</a></li>
	
		<li class="sub-item"> <a href=https://ghfkddorl.github.io/section_python/003_%EC%9D%B4%ED%84%B0%EB%9F%AC%EB%B8%943/> 이터러블-제너레이터(3)</a></li>
	
		<li class="sub-item"> <a href=https://ghfkddorl.github.io/section_python/001_%EC%9D%B4%ED%84%B0%EB%9F%AC%EB%B8%941/> 이터러블-제너레이터(1)</a></li>
	</ul>
</ul>
</div>


<footer>
	<div class="section" id="section1">
		[ PROGRAMING DIARY ]
	</div>
	<div class="section" id="section2">
		<div class="icon-wrap" onclick="sendMail()">
		<div class="icon svg-ajax" id="icon-mail">/img/mail.svg
		</div></div>

		<div class="icon-wrap" onclick="openGithub()">
		<div class="icon svg-ajax" id="icon-github">/img/github.svg
		</div></div>
		CONCAT ... $
	</div>
</footer>



		</aside>
		<main id="app-content">
		<article id="app-content-wrap">
			
  <article class="post">
    <div class="post-header">
      <h1 class ="post-title">제약이 있는 경사하강법</h1>
      <div class="post-meta">
        <div class="post-meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Apr 14, 2019
        </div>
        <div class="post-meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          6 min read
        </div></div>
    </div>

    
	<div class="post-content">
	  

<h2 id="1-경사하강법">1. 경사하강법</h2>

<p>임의의 점에서 시작하여 기울기가 가장 급격한 방향으로 이동하여 임의의 함수 $f$의 극소점에 도달하는 방법을 경사하강법이라고 합니다. 간단하게 다음과 같이 구현할 수 있습니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">C0 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(<span style="color:#ae81ff">0.0</span>)
C1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array((<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>),)
C2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(((<span style="color:#ae81ff">1.0</span>,<span style="color:#ae81ff">0.0</span>),(<span style="color:#ae81ff">0.0</span>,<span style="color:#ae81ff">1.0</span>),))
step_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(x):
	<span style="color:#66d9ef">return</span> C0 <span style="color:#f92672">+</span> C1 <span style="color:#960050;background-color:#1e0010">@</span> x<span style="color:#f92672">.</span>T <span style="color:#f92672">+</span> x <span style="color:#960050;background-color:#1e0010">@</span> C2 <span style="color:#960050;background-color:#1e0010">@</span> x<span style="color:#f92672">.</span>T

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gradient_f</span>(x):
	<span style="color:#66d9ef">return</span> C1 <span style="color:#f92672">+</span> x <span style="color:#960050;background-color:#1e0010">@</span> ( C2 <span style="color:#f92672">+</span> C2<span style="color:#f92672">.</span>T )

p <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array((<span style="color:#ae81ff">9.0</span>, <span style="color:#ae81ff">3.0</span>,))
path <span style="color:#f92672">=</span> [(<span style="color:#f92672">*</span>p, f(p),)]
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">30</span>):
	grad <span style="color:#f92672">=</span> gradient_f(p)
	step_vec <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>grad <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(grad, ord<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
	step <span style="color:#f92672">=</span> step_size <span style="color:#f92672">*</span> step_vec
	p <span style="color:#f92672">+=</span> step
	path <span style="color:#f92672">+=</span> [(<span style="color:#f92672">*</span>p, f(p),)]

show(path)</code></pre></td></tr></table>
</div>
</div>
<embed
	src="gd1.embed"
	type="text/html"
	width=100% 
	height=600rem>
</embed>


<h2 id="2-제약이-있을-경우-경사하강법">2. 제약이 있을 경우 경사하강법</h2>

<p>$$ \begin{array}{ll} \tag{1}
    &amp; \min_{x} f(x)\label{0} \newline
    &amp; s.t. \quad g(x) \ge 0
\end{array} $$</p>

<p>위와 같이 조건식 $g$가 있을 때 약간의 문제가 있습니다. 경사하강법을 통해 극소점으로 이동하다보면 조건식을 만족하기 위해 더 이상 이동할 수 없는 점이 있습니다. 이 점은 $x$는 $g(x)=0$을 만족하고, 앞으로 나오는 $x$, 기울기($\nabla f$, $\nabla g$)는 이 점을 기준으로 합니다. 그리고 $x$에서 조건식을 고려한 이동방향을 $v$라고 합시다.</p>

<p>$x$에선 조건식에 의해 이동 가능한 방향에 제약이 있습니다. 하지만 기본 원리는 조건식이 없을 때와 같습니다. 기울기가 가장 급격한 방향으로 움직입니다. 이동 했을 때 목적함수 $f$의 변화량은 $\nabla f^T v$입니다. 따라서 $\nabla f^T v$를 최대화 혹은 최소화하는 방향으로 움직입니다. 최소화문제라면 이 크기가 가장 작은 방향으로 이동하고, 최대화 문제라면 가장 큰 방향으로 이동합니다. 문제(1)은 최소화 문제이므로 가장 작은 방향으로 이동합니다.</p>

<p>우선 조건식에 의해 이동방향이 어떻게 제약되는지 알아야 합니다. $x$에서 $v$ 방향으로 이동하면 $g(x)$의 변화량은 $\nabla g(x)^T v$입니다. $\nabla g(x)^T v$이 양수 혹은 0이면 $v$ 방향으로 이동해도 $g(x) \ge 0$를 만족합니다. (만약 조건식의 부등호 방향이 반대라면 내적이 음수인 방향으로 이동합니다.). 따라서 $v$를 구하는 문제는 다음과 같은 최적화 문제가 됩니다.</p>

<p>$$ \begin{array}{l} \tag{2}
    &amp; \min_{v} \nabla f^T v \newline
    &amp; s.t. \quad \|v\| = 1 \quad \nabla g^T v \ge 0
\end{array} $$</p>

<p>행렬 $M$의 컬럼 $e_0$, $e_1$, $ e_2$ &hellip; 가 $g^\bot$의 orthonormal basis라고 합시다. 그럼 $v$를 (3)과 같이 변수 $\lambda$와 벡터 $u$로 표현하여 조건 $\nabla g^T v \ge 0$을 확인하게 쉽게 만듭니다. $v$는 $\lambda$와 $u$에 의해 유일하게 표현되며 $\lambda$ 가 양수일 때만 조건 $\nabla g^T \ge 0$를 만족합니다.</p>

<p>$$ \begin{array}{l} \tag{3}
v = \lambda \frac{\nabla g}{\|\nabla g\|} + Mu\newline
\lambda^2 + \|u\|^2 = 1 \quad \lambda \ge 0
\end{array} $$</p>

<p>문제(2)의 $v$를 $\lambda$와 $u$로 치환해줍니다.</p>

<p>$$ \begin{array}{l} \tag{4}
\min_{\lambda, u} \lambda \frac{1}{\|\nabla g\|} \nabla f^T \nabla g + \nabla f Mu \newline
\lambda^2 + \|u\|^2 = 1 \quad \lambda \ge 0
\end{array} $$</p>

<p>최소화 문제이기 때문제 $-\nabla f^T$방향으로 이동하는 것이 가장 이상적입니다. $-\nabla f^T \nabla g$ 이 양수거나 0이면 $x$는 $-\nabla f^T$로 이동해도 조건식을 만족합니다. 이는 일반적인 경사하강법과 같습니다. 따라서 $-\nabla f^T \nabla g$이 음수일 경우만 고려합니다. $-\nabla f^T \nabla g$이 양수거나 0이면 $\lambda$가 0일 때 문제(4)는 최소화 되고, 문제(4)는 문제(5)가 됩니다.</p>

<p>$$ \begin{array}{l} \tag{5}
\min_{u} \nabla f^T Mu \newline
\|u\| = 1
\end{array} $$</p>

<p>문제(5)의 $u$는 라그랑주 승수법을 사용해 쉽게 구할 수 있습니다.</p>

<p>$$ \begin{array}{l} \tag{6}
u = - \frac{1}{\| \nabla f \|} M^T \nabla f
\end{array} $$</p>

<p>구한 $u$를 통해 $v$를 구합니다.</p>

<p>$$ \tag{7}
v = Mu = - \frac{1}{\| \nabla f \|} M M^T \nabla f \quad(\text{if} \: -\nabla f^T \nabla g &lt; 0)
$$</p>

<p>만약 최대화 문제였다면 다음과 같습니다.</p>

<p>$$ \tag{7-2}
v = Mu = \frac{1}{\| \nabla f \|} M M^T \nabla f \quad(\text{if} \: \nabla f \cdot \nabla g &lt; 0)
$$</p>

<h2 id="3-예시">3. 예시</h2>

<p>Linear 함수를 조건식으로 최소점을 가지는 Convex 함수를 최소화 해봅시다. (1)의 최적화문제의 $f$와 $g$를 다음과 같이 정의합니다. f가 최소점을 가지기 위해 $C_2$는 positive definite matrix입니다.</p>

<p>$$ \begin{array}{l} \tag{8}
    f(x) = C_0 + x^T C_1 + x^T C_2 x \newline
    g(x) = B + x^T W
\end{array} $$</p>

<p>이동에 제약이 없을 경우 경사하강법을 사용해 이동합니다. 제약이 있을 경우 $g$에 의해 제약된 방향중 가장 급격한 방향으로 이동합니다. 이 방향은 <code>norm_gradient_f_subject_to_g()</code> 함수를 통해 구합니다. 이동 중 조건식을 만족하지 않는 영역에 들어가면 조건식을 만족하는 가장 가까운 위치로 이동합니다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">W <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array((<span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">1.0</span>,))
B <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array((<span style="color:#f92672">-</span><span style="color:#ae81ff">5.0</span>))
precision <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0001</span>

w_norm <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(W, ord<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
w <span style="color:#f92672">=</span> W <span style="color:#f92672">/</span> w_norm
b <span style="color:#f92672">=</span> B <span style="color:#f92672">/</span> w_norm
_, s, v_inv <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>svd(np<span style="color:#f92672">.</span>matrix(W))
m <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(v_inv[len(s):]) <span style="color:#75715e"># m is orthogonal basis</span>
mT_m <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>T <span style="color:#960050;background-color:#1e0010">@</span> m

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">norm_gradient_f_subject_to_g</span>(grad):
	<span style="color:#66d9ef">if</span> grad <span style="color:#960050;background-color:#1e0010">@</span> w<span style="color:#f92672">.</span>T <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span> grad <span style="color:#f92672">/</span>np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(grad, ord<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
	step_vec <span style="color:#f92672">=</span> grad <span style="color:#960050;background-color:#1e0010">@</span> mT_m
	<span style="color:#66d9ef">return</span> step_vec <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(step_vec, ord<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distance_from_g</span>(p):
	<span style="color:#66d9ef">return</span> p <span style="color:#960050;background-color:#1e0010">@</span> w<span style="color:#f92672">.</span>T <span style="color:#f92672">+</span> b, w
	

p <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array((<span style="color:#ae81ff">9.0</span>, <span style="color:#ae81ff">3.0</span>,))
p_dis, h <span style="color:#f92672">=</span> distance_from_g(p)
<span style="color:#66d9ef">if</span> p_dis <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span>precision:
	<span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#39;condition is not satisfied&#39;</span>)

path <span style="color:#f92672">=</span> [(<span style="color:#f92672">*</span>p, f(p),)]
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">30</span>):
	
	grad <span style="color:#f92672">=</span> gradient_f(p)
	<span style="color:#66d9ef">if</span> p_dis <span style="color:#f92672">&lt;</span> precision:
		step_vec <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>norm_gradient_f_subject_to_g(grad)
	<span style="color:#66d9ef">else</span>:
		step_vec <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>grad <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(grad, ord<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
	step <span style="color:#f92672">=</span> step_size <span style="color:#f92672">*</span> step_vec
	p <span style="color:#f92672">+=</span> step
	
	p_dis, h <span style="color:#f92672">=</span> distance_from_g(p)
	<span style="color:#66d9ef">if</span> p_dis <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span>precision: 
		p <span style="color:#f92672">-=</span> p_dis <span style="color:#f92672">*</span> h
		p_dis, h <span style="color:#f92672">=</span> distance_from_g(p)
	path <span style="color:#f92672">+=</span> [(<span style="color:#f92672">*</span>p, f(p),)]

show(path)</code></pre></td></tr></table>
</div>
</div>
<embed
	src="gd2.embed"
	type="text/html"
	width=100% 
	height=600rem>
</embed>


<h2 id="4-제약이-여러개-있는-경사하강법">4. 제약이 여러개 있는 경사하강법</h2>

<p>$$ \begin{array}{l} \tag{9}
\min_x f(x) \newline
s.t. \quad \forall i \quad g_i(x) \ge 0
\end{array} $$</p>

<p>제약이 여러개 있을 경우도 하나 있을 때와 다르지 않습니다. (9)를 예시로 경사하강법을 사용해 극소점에 다가가는 경로 위의 한 점을 $x$, 이 점에서 이동방향을 $v$라고 하겠습니다($v$의 크기를 1로 합니다.). 앞으로 나올 조건식의 기울기($\nabla g_i$), 목적함수의 기울기($\nabla f$)는 이 점을 기준으로 말합니다. 앞서 말했듯이 조건식이 등식을 만족하면 해당 조건식은 활성화(active) 되었다고 합니다. 그리고 활성화된 조건식은 $x$에서의 이동방향을 제한합니다. $v$와 활성화된 조건식 사이의 내적은 항상 양수 혹은 0 입니다. $v$는 이동 가능한 방향 중 기울기가 가장 급격한 방향으 문제(10)을 최적하는 방향입니다.</p>

<p>$$ \begin{array}{l} \tag{10}
\min_v \nabla f^T v \newline
s.t. \quad \forall i \quad \nabla g_i^T v \ge 0
\end{array} $$</p>

<p>활성화된 조건식의 정규화된 기울기의 집합 $A$를 정의합니다. 이를 이용해 (11)처럼 $M$과 $N$을 정의하고 $v$를 $M$과 $N$ 컬럼의 선형조합으로 표현합니다. 이는 (12)와 같습니다. $N$은 조건식을 만족하는 이동방향을 행렬로 만든것며, $M$은 $N$과 직교인 공간의 기저의 행렬입니다. $\lambda$와 $u$는 선형조합의 계수를 백터로 표현한 것입니다. $N$의 컬럼이 서로독립이라는 보장이 없으므로 $v$는 $\lambda$는 $u$로 유일하게 표현되지 않습니다. 하지만 $v$에 대해 모든 원소가 0이상인 $\lambda$가 존재합니다. 따라서 $\lambda$의 모든 원소가 0이상이라고 가정하고 $v$를 구합니다.</p>

<p>$$ \begin{array}{ll} \tag{11}
A &amp; = &amp; \{ \: \frac{\nabla g_i}{\| \nabla g_i \|} \: | \: g_i(x) = 0 \: \} \newline
N &amp; = &amp; \begin{bmatrix} A_0 | A_1 | A_2 &hellip; \end{bmatrix} \newline
M &amp; = &amp; \text{semi-orthogonal matrix of } N^\bot \newline
     &amp;&amp; ( M \text{&rsquo;s columns is orthonomal basis of } N^\bot )
\end{array} $$</p>

<p>$$ \begin{array}{ll} \tag{12}
v = N \lambda + M u \newline
\|\lambda\| + \|u\| = 1, \quad
\forall i \quad \lambda_i \ge 0
\end{array} $$</p>

<p>문제(10) 의 $v$를 $\lambda$와 $u$로 치환하면 문제(13)이 됩니다.</p>

<p>$$ \begin{array}{l} \tag{13}
\min_{\lambda, u} \nabla f^T N \lambda + \nabla f^T M u  \newline
s.t. \quad
\|\lambda\| + \|u\| = 1, \quad
\forall i \quad \lambda_i \ge 0
\end{array} $$</p>

<p>아시다시피 이 문제의 답은 아래와 같습니다. k는 크기조절을 위한 값으로 양수 입니다.</p>

<p>$$ \begin{array}{l} \tag{14}
\lambda_i &amp;=&amp; \begin{cases}
    0                   &amp; \text{if } -\nabla f^T A_i \le 0 \newline
    -k \nabla f^T A_i &amp; \text{else }
\end{cases} \newline
u_i &amp;=&amp; -k \nabla f^T M_{*,i}
\end{array} $$</p>

<p>따라서 $v$는 다음과 같습니다.
$$v = -k \left( \sum_{-\nabla f^T A_i &gt; 0} \{ A_i f^T A_i \} + M M^T \nabla f \right) \tag{15} $$</p>

<p>최대화 문제였다면 아래와 같습니다.
$$v = k \left( \sum_{\nabla f^T A_i &gt; 0} \{ A_i f^T A_i \} + M M^T \nabla f \right) \tag{15-2}
$$</p>

	</div>
	
	<div id="disqus-wrap">
	<div id="disqus_thread"></div>
	</div>

<script>




(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://https-ghfkddorl-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
	
</article>


		</article>
		</main>
	</body>

</html>
